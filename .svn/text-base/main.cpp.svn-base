#include <QtGui/QApplication>
#include "scene.h"
#include <QTextStream>
#include <iostream>
#include <QGraphicsView>
#include "logger.h"
#include <QDir>
#include <QStringList>
#include <algorithm>
#include "exceptions.h"

bool isLayoutGiven(int argc);
int printUsage(const char* progname);


class VisualNewsApplication : QApplication
{
public:
  VisualNewsApplication(int argc, char** argv)
    : QApplication(argc, argv)
  {
    QApplication::setOverrideCursor(Qt::BlankCursor);
    std::for_each(argv, argv+argc, [this](char* arg) { _arguments.append(arg); } );
  }

  int  run()
  {
    _scene.fillScene(_arguments[1]);
    _scene.start();
  //        scene->getMainView()->showFullScreen();
    _scene.getMainView()->showMinimized();
    return this->exec();
  }

private:
  Scene       _scene;
  QStringList _arguments;
};

int main(int argc, char** argv)
{
  if (!isLayoutGiven(argc))
    return printUsage(argv[0]);

  VisualNewsApplication vnapp(argc, argv);

  int ret = 1;
  try
  {
    ret = vnapp.run();
  }
  catch(IException& ex)
  {
    ex.print();
    return 1;
  }

  return ret;
}

bool isLayoutGiven(int argc) { return argc >= 2; }

int printUsage(const char* progname)
{
  std::cout << "-. missing parameters" << std::endl;
  std::cout << "-. usage: " << progname << " LAYOUT-FILE [PARAMÃ‰TEREK]" << std::endl;
  return 1;
}
